<template>
  <loginBox></loginBox>
  <vc-popup :show.sync="vcPopupCss" :detail.sync="vcPopupDetail" :dataType.sync="dataType" :btnShow.sync="btnShow">
  </vc-popup>
  <classify :rootcateList.sync="vcCateList" :testData.sync="vcDetailList">
  </classify>
</template>

<script>
  import wepy from 'wepy'
  import { connect, getStore } from 'wepy-redux'
  import { asyncVcCateList, asyncDetailList } from '../store/actions'
  import classify from '../components/common/classify'
  import popup from '../components/common/popup'
  import loginBox from '../components/common/login-box'
  @connect({
    vcDetailList(state) {
      return state.vcPage.vcDetailList
    },
    vcCateList(state) {
      return state.vcPage.vcCateList
    }
  })
  export default class extends wepy.page {
    config = {
      navigationBarTitleText: '分类'
    }
    components = {
      classify,
      'vc-popup': popup,
      loginBox
    }
    data = {
      vcPopupCss: 'visibility:hidden;',
      vcPopupDetail: {},
      dataType: 'vcPage',
      btnShow: 'display:block;'
    }
    onLoad() {
      const store = getStore()
      wepy.showLoading({
        title: 'loading...'
      })
      Promise.all([store.dispatch(asyncVcCateList()), store.dispatch(asyncDetailList())]).then(res => {
        wepy.hideLoading()
        this.$broadcast('EdataCate')
      })
    }
    onShow() {}
    vcDetailById(index) {
      return this.vcDetailList.filter(({id}) => id === index)
    }
    computed = {}
    methods = {}
    events = {
      showDetail(index) {
        console.log('EshowDetail')
        this.vcPopupCss = 'visibility:visible;'
        this.btnShow = 'display:block;'
        const vcDetail = this.vcDetailById(index)
        if (vcDetail.length > 0) this.vcPopupDetail = vcDetail[0]
      }
    }
  }
</script>

<style lang="less">
  page {
    background: #f5f5f5;
  }
</style>
